<!doctype html>
<html class="theme-next use-motion theme-next-mist">
<head>
    

<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />


  <meta name="google-site-verification" content="VvyjvVXcJQa0QklHipu6pwm2PJGnnchIqX7s5JbbT_0" />





  <link rel="stylesheet" type="text/css" href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5"/>




<link rel="stylesheet" type="text/css" href="/css/main.css?v=0.4.4"/>




  <meta name="keywords" content="Python," />





  <link rel="shorticon icon" type="image/x-icon" href="/favicon.ico?v=0.4.4" />


<meta name="description" content="urllib2是Python的一个获取URLs(Uniform Resource Locators)的组件。他以urlopen函数的形式提供了一个非常简单的接口，">
<meta property="og:type" content="article">
<meta property="og:title" content="Python urllib2">
<meta property="og:url" content="sunsays.net/2015/10/26/Python-urllib2/index.html">
<meta property="og:site_name" content="SunSays">
<meta property="og:description" content="urllib2是Python的一个获取URLs(Uniform Resource Locators)的组件。他以urlopen函数的形式提供了一个非常简单的接口，">
<meta property="og:updated_time" content="2015-10-26T04:45:17.333Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Python urllib2">
<meta name="twitter:description" content="urllib2是Python的一个获取URLs(Uniform Resource Locators)的组件。他以urlopen函数的形式提供了一个非常简单的接口，">


<script type="text/javascript" id="hexo.configuration">
  var CONFIG = {
    scheme: 'Mist',
    sidebar: 'post'
  };
</script>

    <title> Python urllib2 // SunSays </title>
</head>
<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">
<!--[if lte IE 8]>
  <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'>
    <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode">
      <img src="http://7u2nvr.com1.z0.glb.clouddn.com/picouterie.jpg" border="0" height="42" width="820"
           alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today or use other browser ,like chrome firefox safari."
           style='margin-left:auto;margin-right:auto;display: block;'/>
    </a>
  </div>
<![endif]-->


  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?50c15455e37f70aea674ff4a663eef27";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>



<div class="container one-column page-post-detail">
    <div class="headband"></div>
    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
        <div class="header-inner"><h1 class="site-meta">
  <span class="logo-line-before"><i></i></span>
  <a href="/" class="brand" rel="start">
      <span class="logo">
        <i class="icon-logo"></i>
      </span>
      <span class="site-title">SunSays</span>
  </a>
  <span class="logo-line-after"><i></i></span>
</h1>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu ">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            <i class="menu-item-icon icon-home"></i> <br />
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            <i class="menu-item-icon icon-archives"></i> <br />
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            <i class="menu-item-icon icon-tags"></i> <br />
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            <i class="menu-item-icon icon-about"></i> <br />
            关于
          </a>
        </li>
      
    </ul>
  

  
</nav>


        </div>
    </header>

    <main id="main" class="main">
        <div class="main-inner">
            <div id="content" class="content">
                

  <div id="posts" class="posts-expand">
    

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              Python urllib2
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于
          <time itemprop="dateCreated" datetime="2015-10-26T12:36:40+08:00" content="2015-10-26">
            2015-10-26
          </time>
        </span>

        

        
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        <span itemprop="articleBody"><p>urllib2是Python的一个获取URLs(Uniform Resource Locators)的组件。他以urlopen函数的形式提供了一个非常简单的接口，<br><a id="more"></a><br>这是具有利用不同协议获取URLs的能力，他同样提供了一个比较复杂的接口来处理一般情况，例如：基础验证，cookies,代理和其他。<br>它们通过handlers和openers的对象提供。<br>urllib2支持获取不同格式的URLs(在URL的”:”前定义的字串,例如：”ftp”是”ftp:python.ort/“的前缀),它们利用它们相关网络协议(例如FTP,HTTP)<br>进行获取。这篇教程关注最广泛的应用—HTTP。<br>对于简单的应用，urlopen是非常容易使用的。但当你在打开HTTP的URLs时遇到错误或异常，你将需要一些超文本传输协议(HTTP)的理解。<br>最权威的HTTP文档当然是RFC 2616(<a href="http://rfc.net/rfc2616.html)。这是一个技术文档，所以并不易于阅读。这篇HOWTO教程的目的是展现如何使用urllib2" target="_blank" rel="external">http://rfc.net/rfc2616.html)。这是一个技术文档，所以并不易于阅读。这篇HOWTO教程的目的是展现如何使用urllib2</a>,<br>并提供足够的HTTP细节来帮助你理解。他并不是urllib2的文档说明，而是起一个辅助作用。<br>获取 URLs<br>最简单的使用urllib2将如下所示<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib2 </span><br><span class="line">response = urllib2.urlopen(<span class="string">'http://python.org/'</span>) </span><br><span class="line">html = response.read()</span><br></pre></td></tr></table></figure></p>
<p>urllib2的很多应用就是那么简单(记住，除了”http:”,URL同样可以使用”ftp:”,”file:”等等来替代)。但这篇文章是教授HTTP的更复杂的应用。<br>HTTP是基于请求和应答机制的—客户端提出请求，服务端提供应答。urllib2用一个Request对象来映射你提出的HTTP请求,在它最简单的使用形式中你将用你要请求的<br>地址创建一个Request对象，通过调用urlopen并传入Request对象，将返回一个相关请求response对象，这个应答对象如同一个文件对象，所以你可以在Response中调用.read()。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib2 </span><br><span class="line">req = urllib2.Request(<span class="string">'http://www.pythontab.com'</span>) </span><br><span class="line">response = urllib2.urlopen(req) </span><br><span class="line">the_page = response.read()</span><br></pre></td></tr></table></figure></p>
<p>记得urllib2使用相同的接口处理所有的URL头。例如你可以像下面那样创建一个ftp请求。<br>req = urllib2.Request(‘ftp://example.com/‘)<br>在HTTP请求时，允许你做额外的两件事。首先是你能够发送data表单数据，其次你能够传送额外的关于数据或发送本身的信息(“metadata”)到服务器，此数据作为HTTP的”headers”来发送。<br>接下来让我们看看这些如何发送的吧。<br>Data数据<br>有时候你希望发送一些数据到URL(通常URL与CGI[通用网关接口]脚本，或其他WEB应用程序挂接)。在HTTP中,这个经常使用熟知的POST请求发送。这个通常在你提交一个HTML表单时由你的浏览器来做。<br>并不是所有的POSTs都来源于表单，你能够使用POST提交任意的数据到你自己的程序。一般的HTML表单，data需要编码成标准形式。然后做为data参数传到Request对象。编码工作使用urllib的函数而非urllib2。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib </span><br><span class="line"><span class="keyword">import</span> urllib2 </span><br><span class="line">url = <span class="string">'http://www.pythontab.com'</span> </span><br><span class="line">values = &#123;<span class="string">'name'</span> : <span class="string">'Michael Foord'</span>, </span><br><span class="line">          <span class="string">'location'</span> : <span class="string">'pythontab'</span>, </span><br><span class="line">          <span class="string">'language'</span> : <span class="string">'Python'</span> &#125; </span><br><span class="line">data = urllib.urlencode(values) </span><br><span class="line">req = urllib2.Request(url, data) </span><br><span class="line">response = urllib2.urlopen(req) </span><br><span class="line">the_page = response.read()</span><br></pre></td></tr></table></figure></p>
<p>记住有时需要别的编码(例如从HTML上传文件—看<a href="http://www.w3.org/TR/REC-html40/interact/forms.html#h-17.13" target="_blank" rel="external">http://www.w3.org/TR/REC-html40/interact/forms.html#h-17.13</a> HTML Specification, Form Submission的详细说明)。<br>如ugoni没有传送data参数，urllib2使用GET方式的请求。GET和POST请求的不同之处是POST请求通常有”副作用”，它们会由于某种途径改变系统状态(例如提交成堆垃圾到你的门口)。<br>尽管HTTP标准说的很清楚POSTs通常会产生副作用，GET请求不会产生副作用，但没有什么可以阻止GET请求产生副作用，同样POST请求也可能不产生副作用。Data同样可以通过在Get请求<br>的URL本身上面编码来传送。<br>可看如下例子<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">import</span> urllib2 </span><br><span class="line"> <span class="keyword">import</span> urllib </span><br><span class="line"> data = &#123;&#125; </span><br><span class="line"> data[<span class="string">'name'</span>] = <span class="string">'Somebody Here'</span> </span><br><span class="line"> data[<span class="string">'location'</span>] = <span class="string">'pythontab'</span> </span><br><span class="line"> data[<span class="string">'language'</span>] = <span class="string">'Python'</span> </span><br><span class="line"> url_values = urllib.urlencode(data) </span><br><span class="line"> <span class="keyword">print</span> url_values </span><br><span class="line">name=blueelwang+Here&amp;language=Python&amp;location=pythontab </span><br><span class="line"> url = <span class="string">'http://www.pythontab.com'</span> </span><br><span class="line"> full_url = url + <span class="string">'?'</span> + url_values </span><br><span class="line"> data = urllib2.open(full_url)</span><br></pre></td></tr></table></figure></p>
<p>Headers<br>我们将在这里讨论特定的HTTP头，来说明怎样添加headers到你的HTTP请求。</p>
<p>有一些站点不喜欢被程序（非人为访问）访问，或者发送不同版本的内容到不同的浏览器。默认的urllib2把自己作为“Python-urllib/x.y”(x和y是Python主版本和次版本号,例如Python-urllib/2.5)，<br>这个身份可能会让站点迷惑，或者干脆不工作。浏览器确认自己身份是通过User-Agent头，当你创建了一个请求对象，你可以给他一个包含头数据的字典。下面的例子发送跟上面一样的内容，但把自身<br>模拟成Internet Explorer。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib </span><br><span class="line"><span class="keyword">import</span> urllib2 </span><br><span class="line">url = <span class="string">'http://www.pythontab.com'</span> </span><br><span class="line">user_agent = <span class="string">'Mozilla/4.0 (compatible; MSIE 5.5; Windows NT)'</span> </span><br><span class="line">  </span><br><span class="line">values = &#123;<span class="string">'name'</span> : <span class="string">'Michael Foord'</span>, </span><br><span class="line">          <span class="string">'location'</span> : <span class="string">'pythontab'</span>, </span><br><span class="line">          <span class="string">'language'</span> : <span class="string">'Python'</span> &#125; </span><br><span class="line">headers = &#123; <span class="string">'User-Agent'</span> : user_agent &#125; </span><br><span class="line">data = urllib.urlencode(values) </span><br><span class="line">req = urllib2.Request(url, data, headers) </span><br><span class="line">response = urllib2.urlopen(req) </span><br><span class="line">the_page = response.read()</span><br></pre></td></tr></table></figure></p>
<p>response应答对象同样有两个很有用的方法。看下面的节info and geturl，我们将看到当发生错误时会发生什么。<br>Handle Exceptions处理异常<br>当urlopen不能够处理一个response时，产生urlError（不过通常的Python APIs异常如ValueError,TypeError等也会同时产生）。<br>HTTPError是urlError的子类，通常在特定HTTP URLs中产生。<br>URLError<br>通常，URLError在没有网络连接(没有路由到特定服务器),或者服务器不存在的情况下产生。这种情况下，异常同样会带有”reason”属性，它是一个tuple，包含了一个错误号和一个错误信息。<br>例如<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">req = urllib2.Request(<span class="string">'http://www.pythontab.com'</span>) </span><br><span class="line"><span class="keyword">try</span>: urllib2.urlopen(req) </span><br><span class="line"><span class="keyword">except</span> URLError, e: </span><br><span class="line">   <span class="keyword">print</span> e.reason</span><br></pre></td></tr></table></figure></p>
<p>(4, ‘getaddrinfo failed’)<br>HTTPError<br>服务器上每一个HTTP 应答对象response包含一个数字”状态码”。有时状态码指出服务器无法完成请求。默认的处理器会为你处理一部分这种应答(例如:假如response是一个”重定向”，需要客户端从别的地址获取文档<br>，urllib2将为你处理)。其他不能处理的，urlopen会产生一个HTTPError。典型的错误包含”404”(页面无法找到)，”403”(请求禁止)，和”401”(带验证请求)。<br>请看RFC 2616 第十节有所有的HTTP错误码<br>HTTPError实例产生后会有一个整型’code’属性，是服务器发送的相关错误号。<br>Error Codes错误码<br>因为默认的处理器处理了重定向(300以外号码)，并且100-299范围的号码指示成功，所以你只能看到400-599的错误号码。<br>BaseHTTPServer.BaseHTTPRequestHandler.response是一个很有用的应答号码字典，显示了RFC 2616使用的所有的应答号。这里为了方便重新展示该字典。（译者略）<br>当一个错误号产生后，服务器返回一个HTTP错误号，和一个错误页面。你可以使用HTTPError实例作为页面返回的应答对象response。这表示和错误属性一样，它同样包含了read,geturl,和info方法。<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"> req = urllib2.Request('http://www.python.org/fish.html') </span><br><span class="line"> try: </span><br><span class="line">     urllib2.urlopen(req) </span><br><span class="line"> except URLError, e: </span><br><span class="line">     print e.code </span><br><span class="line">     print e.read() </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">404 </span><br><span class="line">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" </span><br><span class="line">    "http://www.w3.org/TR/html4/loose.dtd"&gt; </span><br><span class="line">&lt;?xml-stylesheet href="./css/ht2html.css" </span><br><span class="line">    type="text/css"?&gt; </span><br><span class="line">&lt;html&gt;&lt;head&gt;&lt;title&gt;Error 404: File Not Found&lt;/title&gt; </span><br><span class="line">...... etc...</span><br></pre></td></tr></table></figure></p>
<p>Wrapping it Up包装<br>所以如果你想为HTTPError或URLError做准备，将有两个基本的办法。我则比较喜欢第二种。<br>第一个：<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">from urllib2 import Request, urlopen, URLError, HTTPError </span><br><span class="line">req = Request(someurl) </span><br><span class="line">try: </span><br><span class="line">    response = urlopen(req) </span><br><span class="line">except HTTPError, e: </span><br><span class="line">    print 'The server couldn/'t fulfill the request.' </span><br><span class="line">    print 'Error code: ', e.code </span><br><span class="line">except URLError, e: </span><br><span class="line">    print 'We failed to reach a server.' </span><br><span class="line">    print 'Reason: ', e.reason </span><br><span class="line">else: </span><br><span class="line">    # everything is fine</span><br></pre></td></tr></table></figure></p>
<p>注意：except HTTPError 必须在第一个，否则except URLError将同样接受到HTTPError。<br>第二个：<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">from urllib2 import Request, urlopen, URLError </span><br><span class="line">req = Request(someurl) </span><br><span class="line">try: </span><br><span class="line">    response = urlopen(req) </span><br><span class="line">except URLError, e: </span><br><span class="line">    if hasattr(e, 'reason'): </span><br><span class="line">        print 'We failed to reach a server.' </span><br><span class="line">        print 'Reason: ', e.reason </span><br><span class="line">    elif hasattr(e, 'code'): </span><br><span class="line">        print 'The server couldn/'t fulfill the request.' </span><br><span class="line">        print 'Error code: ', e.code </span><br><span class="line">else: </span><br><span class="line">    # everything is fine</span><br></pre></td></tr></table></figure></p>
<p>info and geturl<br>urlopen返回的应答对象response(或者HTTPError实例)有两个很有用的方法info()和geturl()<br>geturl — 这个返回获取的真实的URL，这个很有用，因为urlopen(或者opener对象使用的)或许<br>会有重定向。获取的URL或许跟请求URL不同。<br>info — 这个返回对象的字典对象，该字典描述了获取的页面情况。通常是服务器发送的特定头headers。目前是httplib.HTTPMessage 实例。<br>经典的headers包含”Content-length”，”Content-type”，和其他。查看Quick Reference to HTTP Headers(<a href="http://www.cs.tut.fi/~jkorpela/http.html" target="_blank" rel="external">http://www.cs.tut.fi/~jkorpela/http.html</a>)<br>获取有用的HTTP头列表，以及它们的解释意义。<br>Openers和Handlers<br>当你获取一个URL你使用一个opener(一个urllib2.OpenerDirector的实例，urllib2.OpenerDirector可能名字可能有点让人混淆。)正常情况下，我们<br>使用默认opener — 通过urlopen,但你能够创建个性的openers，Openers使用处理器handlers，所有的“繁重”工作由handlers处理。每个handlers知道<br>如何通过特定协议打开URLs，或者如何处理URL打开时的各个方面，例如HTTP重定向或者HTTP cookies。<br>如果你希望用特定处理器获取URLs你会想创建一个openers，例如获取一个能处理cookie的opener，或者获取一个不重定向的opener。<br>要创建一个 opener,实例化一个OpenerDirector，然后调用不断调用.add_handler(some_handler_instance).<br>同样，可以使用build_opener，这是一个更加方便的函数，用来创建opener对象，他只需要一次函数调用。<br>build_opener默认添加几个处理器，但提供快捷的方法来添加或更新默认处理器。<br>其他的处理器handlers你或许会希望处理代理，验证，和其他常用但有点特殊的情况。<br>install_opener 用来创建（全局）默认opener。这个表示调用urlopen将使用你安装的opener。<br>Opener对象有一个open方法，该方法可以像urlopen函数那样直接用来获取urls：通常不必调用install_opener，除了为了方便。<br>Basic Authentication 基本验证<br>为了展示创建和安装一个handler，我们将使用HTTPBasicAuthHandler，为了更加细节的描述本主题—包含一个基础验证的工作原理。<br>请看Basic Authentication Tutorial（<a href="http://www.voidspace.org.uk/python/articles/authentication.shtml）" target="_blank" rel="external">http://www.voidspace.org.uk/python/articles/authentication.shtml）</a><br>当需要基础验证时，服务器发送一个header(401错误码) 请求验证。这个指定了scheme 和一个‘realm’，看起来像这样：Www-authenticate: SCHEME realm=”REALM”.<br>例如<br>Www-authenticate: Basic realm=”cPanel Users”<br>客户端必须使用新的请求，并在请求头里包含正确的姓名和密码。这是“基础验证”，为了简化这个过程，我们可以创建一个HTTPBasicAuthHandler的实例，并让opener使用这个<br>handler。<br>HTTPBasicAuthHandler使用一个密码管理的对象来处理URLs和realms来映射用户名和密码。如果你知道realm(从服务器发送来的头里)是什么，你就能使用HTTPPasswordMgr。<br>通常人们不关心realm是什么。那样的话，就能用方便的HTTPPasswordMgrWithDefaultRealm。这个将在你为URL指定一个默认的用户名和密码。这将在你为特定realm提供一个其他组合时<br>得到提供。我们通过给realm参数指定None提供给add_password来指示这种情况。<br>最高层次的URL是第一个要求验证的URL。你传给.add_password()更深层次的URLs将同样合适。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建一个密码管理者 </span></span><br><span class="line">password_mgr = urllib2.HTTPPasswordMgrWithDefaultRealm() </span><br><span class="line"><span class="comment"># 添加用户名和密码 </span></span><br><span class="line"><span class="comment"># 如果知道 realm, 我们可以使用他代替 ``None``. </span></span><br><span class="line">top_level_url = <span class="string">"http://example.com/foo/"</span> </span><br><span class="line">password_mgr.add_password(<span class="keyword">None</span>, top_level_url, username, password) </span><br><span class="line">handler = urllib2.HTTPBasicAuthHandler(password_mgr) </span><br><span class="line"><span class="comment"># 创建 "opener" (OpenerDirector 实例) </span></span><br><span class="line">opener = urllib2.build_opener(handler) </span><br><span class="line"><span class="comment"># 使用 opener 获取一个URL </span></span><br><span class="line">opener.open(a_url) </span><br><span class="line"><span class="comment"># 安装 opener. </span></span><br><span class="line"><span class="comment"># 现在所有调用 urllib2.urlopen 将用我们的 opener. </span></span><br><span class="line">urllib2.install_opener(opener)</span><br></pre></td></tr></table></figure></p>
<p>注意：以上的例子我们仅仅提供我们的HHTPBasicAuthHandler给build_opener。默认的openers有正常状况的handlers—ProxyHandler,UnknownHandler,HTTPHandler,HTTPDefaultErrorHandler, HTTPRedirectHandler, FTPHandler, FileHandler, HTTPErrorProcessor。<br>top_level_url 实际上可以是完整URL(包含”http:”,以及主机名及可选的端口号)例如：<a href="http://example.com/，也可以是一个“authority”(即主机名和可选的" target="_blank" rel="external">http://example.com/，也可以是一个“authority”(即主机名和可选的</a><br>包含端口号)例如：“example.com” or “example.com:8080”(后者包含了端口号)。权限验证，如果递交的话不能包含”用户信息”部分,例如:<br>“joe@password:example.com”是错误的。<br>Proxies代理urllib 将自动监测你的代理设置并使用他们。这个通过ProxyHandler这个在正常处理器链中的对象来处理。通常，那工作的很好。但有时不起作用<br>。其中一个方法便是安装我们自己的代理处理器ProxyHandler，并不定义代理。这个跟使用Basic Authentication 处理器很相似。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">proxy_support = urllib.request.ProxyHandler(&#123;&#125;) </span><br><span class="line">opener = urllib.request.build_opener(proxy_support) </span><br><span class="line">urllib.request.install_opener(opener)</span><br></pre></td></tr></table></figure></p>
<p>注意：<br>此时urllib.request不支持通过代理获取https地址。但，这个可以通过扩展urllib.request达到目的。<br>Sockets and Layers<br>Python支持获取网络资源是分层结构。urllib 使用http.client库，再调用socket库实现。<br>在Python2.3你可以指定socket的等待回应超时时间。这个在需要获取网页的应用程序里很有用。默认的socket模型没有超时和挂起。现在，socket超时没有暴露<br>给http.client或者urllib.request层。但你可以给所有的sockets设置全局的超时。</p>
</span>
      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Python/" rel="tag">#Python</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-prev post-nav-item">
            
              <a href="/2015/11/10/InlineHook-ASM-exercise/" rel="prev">InlineHook ASM exercise</a>
            
          </div>

          <div class="post-nav-next post-nav-item">
            
              <a href="/2015/10/19/PHPmyadmin-get-shell/" rel="next">PHPmyadmin get shell</a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
        <!-- JiaThis Button BEGIN -->
<div class="jiathis_style">
  <a class="jiathis_button_tsina"></a>
  <a class="jiathis_button_tqq"></a>
  <a class="jiathis_button_weixin"></a>
  <a class="jiathis_button_cqq"></a>
  <a class="jiathis_button_douban"></a>
  <a class="jiathis_button_renren"></a>
  <a class="jiathis_button_qzone"></a>
  <a class="jiathis_button_kaixin001"></a>
  <a class="jiathis_button_copy"></a>
  <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank"></a>
  <a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript" >
  var jiathis_config={
    hideMore:false
  }
</script>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js" charset="utf-8"></script>
<!-- JiaThis Button END -->

      
    </div>
  </div>


            </div>

            

            
              <div class="comments" id="comments">
                
              </div>
            
        </div>

        
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" src="images/avatar.jpg" alt="SXD" itemprop="image"/>
          <p class="site-author-name" itemprop="name">SXD</p>
        </div>
        <p class="site-description motion-element" itemprop="description"></p>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">25</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          <div class="site-state-item site-state-categories">
            
              <span class="site-state-item-count">0</span>
              <span class="site-state-item-name">分类</span>
              
          </div>

          <div class="site-state-item site-state-tags">
            <a href="/tags">
              <span class="site-state-item-count">15</span>
              <span class="site-state-item-name">标签</span>
              </a>
          </div>

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="" target="_blank">GitHub</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="" target="_blank">Twitter</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="" target="_blank">Weibo</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="" target="_blank">DouBan</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="" target="_blank">ZhiHu</a>
              </span>
            
          
        </div>

        
        
          <div class="cc-license motion-element" itemprop="license">
            <a href="http://creativecommons.org/licenses/by-nc-sa/4.0" class="cc-opacity" target="_blank">
              <img src="/images/cc-by-nc-sa.svg" alt="Creative Commons" />
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            <p class="site-author-name">Links</p>
            
              <span class="links-of-author-item">
              <a href="http://bbs.pediy.com/" target="_blank">看雪</a>
              </span>
            
          
        </div>

      </section>

      
        <section class="post-toc-wrap sidebar-panel-active">
          <div class="post-toc-indicator-top post-toc-indicator"></div>
          <div class="post-toc">
            
            
              <p class="post-toc-empty">此文章未包含目录</p>
            
          </div>
          <div class="post-toc-indicator-bottom post-toc-indicator"></div>
        </section>
      

    </div>
  </aside>


    </main>

    <footer id="footer" class="footer">
        <div class="footer-inner">
            <div class="copyright" >
  
  &copy; &nbsp; 
  <span itemprop="copyrightYear">2015</span>
  <span class="with-love">
    <i class="icon-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">SXD</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>



        </div>
    </footer>

    <div class="back-to-top"></div>
</div>

<script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  
  
    
    

  


  
  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/fancy-box.js?v=0.4.4"></script>


  <script type="text/javascript" src="/js/helpers.js?v=0.4.4"></script>
  

  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

  <script type="text/javascript" src="/js/motion_global.js?v=0.4.4" id="motion.global"></script>



  <script type="text/javascript" src="/js/search-toggle.js"></script>


  
<script type="text/javascript" src="/js/bootstrap.scrollspy.js?v=0.4.4" id="bootstrap.scrollspy.custom"></script>


<script type="text/javascript" id="sidebar.toc.highlight">
  $(document).ready(function () {
    var tocSelector = '.post-toc';
    var $tocSelector = $(tocSelector);
    var activeCurrentSelector = '.active-current';

    $tocSelector
      .on('activate.bs.scrollspy', function () {
        var $currentActiveElement = $(tocSelector + ' .active').last();

        removeCurrentActiveClass();
        $currentActiveElement.addClass('active-current');

        $tocSelector[0].scrollTop = $currentActiveElement.position().top;
      })
      .on('clear.bs.scrollspy', function () {
        removeCurrentActiveClass();
      });

    function removeCurrentActiveClass () {
      $(tocSelector + ' ' + activeCurrentSelector)
        .removeClass(activeCurrentSelector.substring(1));
    }

    function processTOC () {
      getTOCMaxHeight();
      toggleTOCOverflowIndicators();
    }

    function getTOCMaxHeight () {
      var height = $('.sidebar').height() -
                   $tocSelector.position().top -
                   $('.post-toc-indicator-bottom').height();

      $tocSelector.css('height', height);

      return height;
    }

    function toggleTOCOverflowIndicators () {
      tocOverflowIndicator(
        '.post-toc-indicator-top',
        $tocSelector.scrollTop() > 0 ? 'show' : 'hide'
      );

      tocOverflowIndicator(
        '.post-toc-indicator-bottom',
        $tocSelector.scrollTop() >= $tocSelector.find('ol').height() - $tocSelector.height() ? 'hide' : 'show'
      )
    }

    $(document).on('sidebar.motion.complete', function () {
      processTOC();
    });

    $('body').scrollspy({ target: tocSelector });
    $(window).on('resize', function () {
      if ( $('.sidebar').hasClass('sidebar-active') ) {
        processTOC();
      }
    });

    onScroll($tocSelector);

    function onScroll (element) {
      element.on('mousewheel DOMMouseScroll', function (event) {
          var oe = event.originalEvent;
          var delta = oe.wheelDelta || -oe.detail;

          this.scrollTop += ( delta < 0 ? 1 : -1 ) * 30;
          event.preventDefault();

          toggleTOCOverflowIndicators();
      });
    }

    function tocOverflowIndicator (indicator, action) {
      var $indicator = $(indicator);
      var opacity = action === 'show' ? 0.4 : 0;
      $indicator.velocity ?
        $indicator.velocity('stop').velocity({
          opacity: opacity
        }, { duration: 100 }) :
        $indicator.stop().animate({
          opacity: opacity
        }, 100);
    }

  });
</script>

<script type="text/javascript" id="sidebar.nav">
  $(document).ready(function () {
    var html = $('html');
    var TAB_ANIMATE_DURATION = 200;
    var hasVelocity = $.isFunction(html.velocity);

    $('.sidebar-nav li').on('click', function () {
      var item = $(this);
      var activeTabClassName = 'sidebar-nav-active';
      var activePanelClassName = 'sidebar-panel-active';
      if (item.hasClass(activeTabClassName)) {
        return;
      }

      var currentTarget = $('.' + activePanelClassName);
      var target = $('.' + item.data('target'));

      hasVelocity ?
        currentTarget.velocity('transition.slideUpOut', TAB_ANIMATE_DURATION, function () {
          target
            .velocity('stop')
            .velocity('transition.slideDownIn', TAB_ANIMATE_DURATION)
            .addClass(activePanelClassName);
        }) :
        currentTarget.animate({ opacity: 0 }, TAB_ANIMATE_DURATION, function () {
          currentTarget.hide();
          target
            .stop()
            .css({'opacity': 0, 'display': 'block'})
            .animate({ opacity: 1 }, TAB_ANIMATE_DURATION, function () {
              currentTarget.removeClass(activePanelClassName);
              target.addClass(activePanelClassName);
            });
        });

      item.siblings().removeClass(activeTabClassName);
      item.addClass(activeTabClassName);
    });

    $('.post-toc a').on('click', function (e) {
      e.preventDefault();
      var targetSelector = escapeSelector(this.getAttribute('href'));
      var offset = $(targetSelector).offset().top;
      hasVelocity ?
        html.velocity('stop').velocity('scroll', {
          offset: offset  + 'px',
          mobileHA: false
        }) :
        $('html, body').stop().animate({
          scrollTop: offset
        }, 500);
    });

    // Expand sidebar on post detail page by default, when post has a toc.
    var $tocContent = $('.post-toc-content');
    if (isDesktop() && CONFIG.sidebar === 'post') {
      if ($tocContent.length > 0 && $tocContent.html().trim().length > 0) {
        displaySidebar();
      }
    }
  });
</script>



<script type="text/javascript">
    $(document).ready(function () {
        if (CONFIG.sidebar === 'always') {
            displaySidebar();
        }
    });
</script>








<!-- lazyload -->
<script type="text/javascript" src="/js/lazyload.js"></script>
<script type="text/javascript">
    jQuery(function () {
        jQuery("#posts img").lazyload({
            placeholder: "/images/loading.gif",
            effect: "fadeIn"
        });
    });
</script>
</body>
</html>
